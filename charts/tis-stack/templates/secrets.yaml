apiVersion: v1
kind: Secret
metadata:
  name: tis-app-secrets
  labels:
    {{- include "tis-stack.labels" . | nindent 4 }}
type: Opaque
# CONVENIENCE:
#   We use 'stringData' instead of 'data'.
#   WHY: This allows us to provide plain text values in the template,
#   which Kubernetes automatically base64 encodes upon creation.
#   This avoids complex base64 piping logic within the Helm template itself.
stringData:
  # VALIDATION:
  #   The 'required' function is a safety gate.
  #   It prevents the chart from installing if these values are missing (empty).
  #   This ensures we never deploy a database with an empty or default password by accident.
  postgres-password: {{ required "A valid .Values.postgres.auth.password is required!" .Values.postgres.auth.password | quote }}

  redis-password: {{ required "A valid .Values.redis.auth.password is required!" .Values.redis.auth.password | quote }}

  # CLOUD CREDENTIALS:
  #   These keys are injected into the application pods to allow access to AWS services (S3/ECR).
  #   RISK: Ensure that the 'values.yaml' file used to populate these is NEVER committed to Git.
  #   Use a secrets manager or '--set' arguments during deployment.
  AWS_ACCESS_KEY_ID: {{ required "AWS Access Key required!" .Values.global.aws.accessKeyId | quote }}
  AWS_SECRET_ACCESS_KEY: {{ required "AWS Secret Key required!" .Values.global.aws.secretAccessKey | quote }}
